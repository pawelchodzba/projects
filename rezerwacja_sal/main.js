//<script>
//	var data_tab_1=[];//hours

let s1_0, s1_1, s1_2, s1_3, s1_4, s1_5, s1_6, s1_7, s1_8, s1_9, s1_10, s1_11, s1_12, s1_13, s1_14, s1_15, s1_16, s1_17, s1_18, s1_19, s1_20, s1_21, s1_22, s1_23, s1_24, s1_25, s1_26, s1_27, s1_28, s1_29,s1_30,s1_31;

let data_fetch_1=[s1_0, s1_1 , s1_2 , s1_3 , s1_4 , s1_5 , s1_6 , s1_7 , s1_8, s1_9 , s1_10 , s1_11 , s1_12 , s1_13 , s1_14 , s1_15 , s1_16 , s1_17 , s1_18 , s1_19 , s1_20 , s1_21 , s1_22 , s1_23 , s1_24 , s1_25 , s1_26 , s1_27 , s1_28 , s1_29,s1_30,s1_31];

let s2_0, s2_1, s2_2, s2_3, s2_4, s2_5, s2_6, s2_7, s2_8, s2_9, s2_10, s2_11, s2_12, s2_13, s2_14, s2_15, s2_16, s2_17, s2_18, s2_19, s2_20, s2_21, s2_22, s2_23, s2_24, s2_25, s2_26, s2_27, s2_28, s2_29,s2_30,s2_31;

let data_fetch_2=[s2_0, s2_1, s2_2 , s2_3 , s2_4 , s2_5 , s2_6 , s2_7 , s2_8, s2_9 , s2_10 , s2_11 , s2_12 , s2_13 , s2_14 , s2_15 , s2_16 , s2_17 , s2_18 , s2_19 , s2_20 , s2_21 , s2_22 , s2_23 , s2_24 , s2_25 , s2_26 , s2_27 , s2_28 , s2_29,s2_30,s2_31];

let s3_0, s3_1, s3_2, s3_3, s3_4, s3_5, s3_6, s3_7, s3_8, s3_9, s3_10, s3_11, s3_12, s3_13, s3_14, s3_15, s3_16, s3_17, s3_18, s3_19, s3_20, s3_21, s3_22, s3_23, s3_24, s3_25, s3_26, s3_27, s3_28, s3_29,s3_30,s3_31;

let data_fetch_3=[s3_0, s3_1, s3_2 , s3_3 , s3_4 , s3_5 , s3_6 , s3_7 , s3_8, s3_9 , s3_10 , s3_11 , s3_12 , s3_13 , s3_14 , s3_15 , s3_16 , s3_17 , s3_18 , s3_19 , s3_20 , s3_21 , s3_22 , s3_23 , s3_24 , s3_25 , s3_26 , s3_27 , s3_28 , s3_29,s3_30,s3_31];

let s4_0, s4_1, s4_2, s4_3, s4_4, s4_5, s4_6, s4_7, s4_8, s4_9, s4_10, s4_11, s4_12, s4_13, s4_14, s4_15, s4_16, s4_17, s4_18, s4_19, s4_20, s4_21, s4_22, s4_23, s4_24, s4_25, s4_26, s4_27, s4_28, s4_29,s4_30,s4_31;

let data_fetch_4=[s4_0, s4_1, s4_2 , s4_3 , s4_4 , s4_5 , s4_6 , s4_7 , s4_8, s4_9 , s4_10 , s4_11 , s4_12 , s4_13 , s4_14 , s4_15 , s4_16 , s4_17 , s4_18 , s4_19 , s4_20 , s4_21 , s4_22 , s4_23 , s4_24 , s4_25 , s4_26 , s4_27 , s4_28 , s4_29,s4_30,s4_31];

let s5_0, s5_1, s5_2, s5_3, s5_4, s5_5, s5_6, s5_7, s5_8, s5_9, s5_10, s5_11, s5_12, s5_13, s5_14, s5_15, s5_16, s5_17, s5_18, s5_19, s5_20, s5_21, s5_22, s5_23, s5_24, s5_25, s5_26, s5_27, s5_28, s5_29,s5_30,s5_31;

let data_fetch_5=[s5_0, s5_1, s5_2 , s5_3 , s5_4 , s5_5 , s5_6 , s5_7 , s5_8, s5_9 , s5_10 , s5_11 , s5_12 , s5_13 , s5_14 , s5_15 , s5_16 , s5_17 , s5_18 , s5_19 , s5_20 , s5_21 , s5_22 , s5_23 , s5_24 , s5_25 , s5_26 , s5_27 , s5_28 , s5_29,s5_30,s5_31];

let s6_0, s6_1, s6_2, s6_3, s6_4, s6_5, s6_6, s6_7, s6_8, s6_9, s6_10, s6_11, s6_12, s6_13, s6_14, s6_15, s6_16, s6_17, s6_18, s6_19, s6_20, s6_21, s6_22, s6_23, s6_24, s6_25, s6_26, s6_27, s6_28, s6_29,s6_30,s6_31;

let data_fetch_6=[s6_0, s6_1, s6_2 , s6_3 , s6_4 , s6_5 , s6_6 , s6_7 , s6_8, s6_9 , s6_10 , s6_11 , s6_12 , s6_13 , s6_14 , s6_15 , s6_16 , s6_17 , s6_18 , s6_19 , s6_20 , s6_21 , s6_22 , s6_23 , s6_24 , s6_25 , s6_26 , s6_27 , s6_28 , s6_29,s6_30,s6_31];

let svg_id_sals=['s_big_0','s_big_1','s_kitchen_2','s_midium_3','s_small_4','s_komi_5'];

	let content=document.getElementById('tabelka');	
	let tab_name=[data_fetch_1,data_fetch_2,data_fetch_3,data_fetch_4,data_fetch_5,data_fetch_6];
	
	let data = new Date();
	let month_int=data.getMonth();
	let month_tab=['styczeń','luty','marzec','kwiecień','maj','czerwiec','lipiec','sierpień','wrzesień','październik','listopad','grudzień'];
	
	let year =data.getFullYear();


//////////////////////////////////month_next/////////////////////	
	
	let mies_plus=document.getElementById('mies_plus');	
	mies_plus.addEventListener('click',next_month,false);
function next_month(){
	month_int++ ;
	if (month_int>11){ month_int=0;year++}
	
	var content_tab=content.getElementsByTagName('table')[0];
	content.removeChild(content_tab);
		
	create_table();
	
	
}
//////////////////////////////////month_befor/////////////////////
	let minus_plus=document.getElementById('mies_minus');	
	mies_minus.addEventListener('click',befor_month,false);
function befor_month(){
	month_int--
	if (month_int<0){ month_int=11;year-- }
	
	var content_tab=content.getElementsByTagName('table')[0];
	content.removeChild(content_tab);
	
	create_table();
}

function create_table(){
	
	  let tip_id=document.getElementById('tip1');
	  month=month_tab[month_int];
	  tip_id.style.display="none";
	  document.getElementById('data_year').innerHTML=month+" "+year;  
	let month_length;
	
		if (month_int==3||month_int==5||month_int==5||month_int==8||month_int==10){
	month_length=31;
	};	
	
	if (month_int==0||month_int==2||month_int==4||month_int==6||month_int==7|month_int==9|month_int==11){
	month_length=32;
	};	
		 
	let data_tab=[0];
	
	let tab =document.createElement('table');
	let tab_body=document.createElement('tbody');
		
	 
	
	 /////////////////////rows////////////////////////////////
	 for ( j=0;j<month_length;j++)
	{
		let row = document.createElement('tr');
	 	 /////////////////////////data/////////////
				  for( i=0;i<1;i++){
						 let cell=document.createElement('td');
							  cell.classList.add('cell');
						let cell_content=document.createTextNode(data_tab[0]+j);
							 cell.appendChild(cell_content);
							 row.appendChild(cell);
							}
	 
	 
			////////sala1////////
		 for( k=0;k<1;k++){
		
			    let cell=document.createElement('td');
					cell.classList.add('cell_1');
					//cell.setAttribute("data-tooltip","#tip1");
					cell.setAttribute("id","sala_1_"+[j]);
				
					row.appendChild(cell);
						
					
		}
		
		 		 	////////sala2////////
		  for( l=0;l<1;l++){
		
				let cell=document.createElement('td');
					cell.classList.add('cell_2');
					//cell.setAttribute("data-tooltip","#tip1");
					cell.setAttribute("id","sala_2_"+[j]);
				   row.appendChild(cell);
		 }
		 ////////sala3////////
		  for( m=0;m<1;m++){
			
				let cell=document.createElement('td');
					  cell.classList.add('cell_3');
					//  cell.setAttribute("data-tooltip","#tip1");
					  cell.setAttribute("id","sala_3_"+[j]);
				 row.appendChild(cell);
			 
		 }
		////////sala4////////
		  for( n=0;n<1;n++){
		
				let cell=document.createElement('td');
					cell.classList.add('cell_4');
				  //  cell.setAttribute("data-tooltip","#tip1");
					cell.setAttribute("id","sala_4_"+[j]);
				 row.appendChild(cell);
		}
		////////sala5////////
		  for( o=0;o<1;o++){
		
			   let cell=document.createElement('td');
				   cell.classList.add('cell_5');
			    //   cell.setAttribute("data-tooltip","#tip1");
					cell.setAttribute("id","sala_5_"+[j]);
				 row.appendChild(cell);
			 
		 }
		
		////////sala6////////
		  for( p=0;p<1;p++){
		
			   let cell=document.createElement('td');
				    cell.classList.add('cell_6');
		          //  cell.setAttribute("data-tooltip","#tip1");
					cell.setAttribute("id","sala_6_"+[j]);
				 row.appendChild(cell);
			
		 }
	 
	 	tab_body.appendChild(row);
	 }
	tab.appendChild(tab_body);
	content.appendChild(tab);
//////////////////////////////////////////////////////////
class_weekend(year,month_int,tab_body);
mouse_over_on_calendar(tab_body,tip_id);
mouse_out_on_calendar(tab_body,tip_id);
from_php_for_tab(); 

title_calendar(tab_body);
click_booking_sale(tab_body);
too_day(tab_body);

}
function too_day(body){
	//alert(body);
	let	day=data.getDate(),
		year_too=data.getFullYear(),
		month_too=data.getMonth();
	
	if(month_int===month_too&&year===year_too){
		body.getElementsByClassName('cell')[day-1].classList.add('too_day');
	};
}

function class_weekend(year,month_int,body){

		let tr=body.getElementsByTagName('tr');
		
				for(i=0;i<tr.length;i++){
					let   data=new Date(year,month_int,i);
					let day_int=data.getDay();
					
					if(day_int===6||day_int===0){//alert(i);
					let row_nr=tr[i];
					
					  for(j=0;j<7;j++){
						 let 	sala_week=row_nr.getElementsByTagName('td')[j];
						sala_week.classList.add('weekend');
					}
				}
				
			}	
		} 
			 
		
function title_calendar(body){
	
	 
		let td=body.getElementsByTagName('td');
			 for(i=0;i<=6;i++){
				 td[i].classList.add('title_calendar');
				 td[i].classList.remove('weekend');
				 
				 let cell_title=document.createTextNode(i);
				 td[i].appendChild(cell_title);
				 td[i].removeAttribute('id');////remove event title calendar
			}
				////first cell////
				 td[0].classList.remove('cell');////first cell////
				 td[0].textContent='';
	}

 function interwal(e,id_tip,nr_sali){ //alert(nr_sali)
	let t=0;
	id_interval= setInterval(function(){
		t++; 
	if(t==4){//
		tooltip_show(e,id_tip); 
		};
	if(t==1){
		hover_on_svg(nr_sali);
		 };
		
	} ,500);
 }

function mouse_over_on_calendar(tab_body,id_tip){
tab_body.addEventListener('mouseover',function (e){
	
let e_target=e.target;
if(e_target.className==='cell weekend' || e_target.className==='cell'||e_target.className==='cell weekend too_day'||e_target.className==='cell too_day' ){
	day_int=parseInt(e_target.textContent),
	get_date(day_int);
 
 }

if(e_target.nodeName==='TD')
	{
		 //id_tip=document.getElementById('tip1'),
		let id=e_target.getAttribute('id'),
			 day_int=parseInt(id.split("_")[2]),//dzień
			 nr_sali=parseInt(id.split("_")[1]),//nr sali	
			 boolean_data_before =none_ev_before_data(day_int),
			 id_tip=document.getElementById('tip1'),
			 tooltip_data;
			 
				if(boolean_data_before){
					tooltip_data="Sala nr "+nr_sali+"<br> "+day_int+"/"+month+"/"+year+"<br>kliknij aby wynająć";
				}else{
					tooltip_data="Sala nr "+nr_sali+"<br> "+day_int+"/"+month+"/"+year;
					}
			 
			 id_tip.innerHTML=tooltip_data;
			
			 let data_day= get_date(day_int);	
			 data_from_tab_into_info(day_int,nr_sali,data_day);
			 interwal(e,id_tip,nr_sali);
			 }
},false);


}

function data_from_tab_into_info(day_id,sala_id,name_day){


	let in_tab;
	let tab=tab_name[sala_id-1];
	let boolean_data_before =none_ev_before_data(day_id);
	let click_book;
	let info;
	for(r=0;r<tab.length;r++){
					if (r===day_id){
						if (tab[r]){
						in_tab="Sala numer "+sala_id+"<br/>"+name_day+" "+day_id+" "+month+" "+year;
						info='<div id="sala_busy_svg">Sala zajęta w godzinach:</div><div id="od_do">'+tab[r]+"</div>";
							
						}else{
								in_tab="Sala numer "+sala_id+" <div>"+name_day+" "+day_id+" "+month+" "+year+"</div>";
								if(boolean_data_before){
								info="<h3>Sala wolna</h3>";
								}else{info=null;}
												
						}
						if(boolean_data_before){
							click_book="Kliknij aby wynająć";
							}else{
								click_book=null;
								}
							
						get_info(in_tab,info,click_book);
					}
					
			}
			
	}

/////////////Show into info svg//////////////
function get_info(from_tab,info_from_tab,click_booking){
	document.getElementById('name').innerHTML=from_tab;
	document.getElementById('info').innerHTML=info_from_tab;
	document.getElementById('img').innerHTML=click_booking;
	
}
///////////data into info svg///////////////
function get_date(day_int){
	
	let data =new Date(year,month_int,day_int),
		 day_int_name=data.getDay(),
		 day_name_tab=["Niedziela","Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota"],
		 day_name=day_name_tab[day_int_name],
		 info="";
		 
		
		 get_info(day_name,info,img='');
		 return day_name;
		 }






function hover_on_svg(nr){
	
		let element_svg=document.getElementById(svg_id_sals[nr-1]);
		if (nr-1<5){
			element_svg.getElementsByTagName('rect')[0].classList.add('hover_on_s')
		}else{
			element_svg.getElementsByTagName('polygon')[0].classList.add('hover_on_s')
		};
	}



function mouse_out_on_calendar(tab_body,p_tip){
	
	
tab_body.addEventListener('mouseout',function(e){
	
	clearInterval(id_interval);
	let e_target=e.target;
	let id=e_target.getAttribute('id'),
	      nr_sali=parseInt(id.split("_")[1]);//nr sali	

	if(e_target.nodeName==='TD'){
		//alert(p_tip);
				p_tip.style.display="none";
				
				let element_svg=document.getElementById(svg_id_sals[nr_sali-1]);
				if (nr_sali-1<5){
					 element_svg.getElementsByTagName('rect')[0].classList.remove('hover_on_s');
					}else{
					element_svg.getElementsByTagName('polygon')[0].classList.remove('hover_on_s')
			}
		}

},false);	
	
}

function click_booking_sale(tbody)
{
tbody.addEventListener('click',function(e){

let e_target=e.target;
if(e_target.nodeName==='TD')
	{
			
	let id=e_target.getAttribute('id'),
		sala_id=id.split("_")[1],
		day_id=id.split("_")[2];
	
		 let boolean_data_before =none_ev_before_data(day_id);
		 if(boolean_data_before){
		    form(sala_id,day_id);
		 }
	}
},false);	
}
function none_ev_before_data(day){
	let month_naw=data.getMonth();
	let year_naw=data.getFullYear();
	let day_naw=data.getDate();
	
	if (year===year_naw&&month_int>month_naw){
				return true;
			}else if(year===year_naw&&month_int===month_naw&&day>=day_naw){
				return true;
			}else if(year>year_naw){
				return true;
			}
		else{return false;}
	
}


 //////////////////////////////ajax//////////////////////////////////////////////
function sala_free(table){
					for(y=0;y<table.length;y++){
					 table[y]=null;
					}
				}
				
function set_data_into_tab(from_fetch,table){ 
	let tab_1=from_fetch.split('_'),
		 into_tab="";
			for(m=2;m<tab_1.length-1;m=m+3){
				let index=parseInt(tab_1[m]),
					 t=tab_1[m-2]+'   -   '+tab_1[m-1];
				into_tab=into_tab+t+'</br>';
				table[index]=into_tab;
			  }	
			}
//////////////main ajax////////////////
function from_php_for_tab(){
		
	 for(v=0;v<=5;v++){
		let v_sala=v;
		let tab=tab_name[v];
		
		sala_free(tab);
		  $.get('fetch.php',{month:month_int+1,year:year,sala:v+1},function(data){//alert(data);
			  set_data_into_tab(data,tab); 	//alert(data);	 		
			  chenge_class_free_sall(v_sala,tab);
		  });
		 }
		}
function chenge_class_free_sall(v,tab){
				for(y=0;y<tab.length;y++){
					if (tab[y]){								
						document.getElementById('sala_'+(v+1)+'_'+y).classList.add('busy');
					}
				  }	
				}

 	//////////////////////////////tooltips//////////////////////////////////////////////
	
	function tooltip_show(ev,id_tip){//
		
			let ttLeft,////position  element div
				 ttTop,
				 scroll_top=$(document).scrollTop();//position scroll
					 if (scroll_top>0){ttTop=ev.clientY+scroll_top+10}
						else {ttTop=ev.clientY+10};
						
						ttLeft=ev.clientX-110;
									
						id_tip.style.display='block';
						id_tip.style.position='absolute';
						id_tip.style.left=ttLeft+"px";
						id_tip.style.top=ttTop+'px';
					
	}
	
	
	
create_table();

